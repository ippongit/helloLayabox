var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /**This class is automatically generated by LayaAirIDE, please do not make any modifications. */


var _CheckRaycast = require("./script/CheckRaycast");

var _CheckRaycast2 = _interopRequireDefault(_CheckRaycast);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var GameConfig = function () {
    function GameConfig() {
        _classCallCheck(this, GameConfig);
    }

    _createClass(GameConfig, null, [{
        key: "init",
        value: function init() {
            //注册Script或者Runtime引用
            var reg = Laya.ClassUtils.regClass;
            reg("script/CheckRaycast.js", _CheckRaycast2.default);
        }
    }]);

    return GameConfig;
}();

exports.default = GameConfig;

GameConfig.width = 1280;
GameConfig.height = 720;
GameConfig.scaleMode = "showall";
GameConfig.screenMode = "none";
GameConfig.alignV = "top";
GameConfig.alignH = "center";
GameConfig.startScene = "main.scene";
GameConfig.sceneRoot = "";
GameConfig.debug = false;
GameConfig.stat = false;
GameConfig.physicsDebug = false;
GameConfig.exportSceneToJson = true;

GameConfig.init();

},{"./script/CheckRaycast":3}],2:[function(require,module,exports){
"use strict";

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _GameConfig = require("./GameConfig");

var _GameConfig2 = _interopRequireDefault(_GameConfig);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Main = function () {
	function Main() {
		_classCallCheck(this, Main);

		//根据IDE设置初始化引擎		
		if (window["Laya3D"]) Laya3D.init(_GameConfig2.default.width, _GameConfig2.default.height);else Laya.init(_GameConfig2.default.width, _GameConfig2.default.height, Laya["WebGL"]);
		Laya["Physics"] && Laya["Physics"].enable();
		Laya["DebugPanel"] && Laya["DebugPanel"].enable();
		Laya.stage.scaleMode = _GameConfig2.default.scaleMode;
		Laya.stage.screenMode = _GameConfig2.default.screenMode;
		Laya.stage.alignV = _GameConfig2.default.alignV;
		Laya.stage.alignH = _GameConfig2.default.alignH;
		//兼容微信不支持加载scene后缀场景
		Laya.URL.exportSceneToJson = _GameConfig2.default.exportSceneToJson;

		//打开调试面板（通过IDE设置调试模式，或者url地址增加debug=true参数，均可打开调试面板）
		if (_GameConfig2.default.debug || Laya.Utils.getQueryString("debug") == "true") Laya.enableDebugPanel();
		if (_GameConfig2.default.physicsDebug && Laya["PhysicsDebugDraw"]) Laya["PhysicsDebugDraw"].enable();
		if (_GameConfig2.default.stat) Laya.Stat.show();
		Laya.alertGlobalError = true;

		//激活资源版本控制，version.json由IDE发布功能自动生成，如果没有也不影响后续流程
		Laya.ResourceVersion.enable("version.json", Laya.Handler.create(this, this.onVersionLoaded), Laya.ResourceVersion.FILENAME_VERSION);
	}

	_createClass(Main, [{
		key: "onVersionLoaded",
		value: function onVersionLoaded() {
			//激活大小图映射，加载小图的时候，如果发现小图在大图合集里面，则优先加载大图合集，而不是小图
			Laya.AtlasInfoManager.enable("fileconfig.json", Laya.Handler.create(this, this.onConfigLoaded));
		}
	}, {
		key: "onConfigLoaded",
		value: function onConfigLoaded() {
			//加载IDE指定的场景
			_GameConfig2.default.startScene && Laya.Scene.open(_GameConfig2.default.startScene);
		}
	}]);

	return Main;
}();
//激活启动类


new Main();

},{"./GameConfig":1}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

/**CheckRaycast */
var CheckRaycast = function (_Laya$Scene) {
    _inherits(CheckRaycast, _Laya$Scene);

    function CheckRaycast() {
        _classCallCheck(this, CheckRaycast);

        return _possibleConstructorReturn(this, (CheckRaycast.__proto__ || Object.getPrototypeOf(CheckRaycast)).call(this));
    }

    _createClass(CheckRaycast, [{
        key: "onEnable",
        value: function onEnable() {
            var conut = 0;
            var vertexs = [];
            var checkedPoint = null;
            Laya.stage.on(Laya.Event.CLICK, this, function (e) {
                var point = new laya.maths.Point(e.stageX, e.stageY);
                if (vertexs.length < 5) {
                    if (vertexs.length > 0) {
                        var lastPoint = vertexs[vertexs.length - 1];
                        Laya.stage.graphics.drawLine(lastPoint.x, lastPoint.y, point.x, point.y, "#ffffff", 3);
                    }
                    vertexs.push(point);
                    if (vertexs.length === 5) {
                        var startPoint = vertexs[0];
                        Laya.stage.graphics.drawLine(startPoint.x, startPoint.y, point.x, point.y, "#ffffff", 3);
                    }
                } else {
                    //定义原点(0,0)
                    var origin = new laya.maths.Point(0, 0);
                    var checkResut = this.checkCross(origin, point, vertexs);
                    //如果射线穿过多边形，是绿色
                    var color = "#00ff00";
                    //如果射线未穿过多边形，是黄色
                    if (checkResut === false) color = "#ffff00";
                    this.graphics.clear();
                    var endX = 1500;
                    var endY = point.y * endX / point.x;
                    this.graphics.drawLine(origin.x, origin.y, endX, endY, color, 3);
                }
            });
        }

        /**检测直线穿过一个多边形 */

    }, {
        key: "checkCross",
        value: function checkCross(startPoint, stopPoint, vertexs) {
            var x_startPoint = startPoint.x;
            var y_startPoint = startPoint.y;
            var x_stopPoint = stopPoint.x;
            var y_stopPoint = stopPoint.y;

            var up = 0;
            var down = 0;
            var crossed = false;

            var k = (y_stopPoint - y_startPoint) / (x_stopPoint - x_startPoint);
            for (var i = 0; i < vertexs.length; i++) {
                var xi = vertexs[i].x,
                    yi = vertexs[i].y;
                var y_cut = k * (xi - x_startPoint) + y_startPoint;
                //多边形与直线相切或穿过
                if (y_cut == yi) {
                    crossed = true;
                    return crossed;
                } else {
                    if (yi > y_cut) up++;else down++;
                }
            }
            if (up > 0 && down > 0) {
                crossed = true;
            }
            return crossed;
        }
    }]);

    return CheckRaycast;
}(Laya.Scene);

exports.default = CheckRaycast;

},{}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL0xheWFBaXJJREUyL3Jlc291cmNlcy9hcHAvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsInNyYy9HYW1lQ29uZmlnLmpzIiwic3JjL01haW4uanMiLCJzcmMvc2NyaXB0L0NoZWNrUmF5Y2FzdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O3FqQkNWQTs7O0FBQ0E7Ozs7Ozs7O0lBRXFCLFU7Ozs7Ozs7K0JBQ0g7QUFDVjtBQUNBLGdCQUFJLE1BQU0sS0FBSyxVQUFMLENBQWdCLFFBQTFCO0FBQ04sZ0JBQUksd0JBQUosRUFBNkIsc0JBQTdCO0FBQ0c7Ozs7OztrQkFMZ0IsVTs7QUFPckIsV0FBVyxLQUFYLEdBQW1CLElBQW5CO0FBQ0EsV0FBVyxNQUFYLEdBQW9CLEdBQXBCO0FBQ0EsV0FBVyxTQUFYLEdBQXNCLFNBQXRCO0FBQ0EsV0FBVyxVQUFYLEdBQXdCLE1BQXhCO0FBQ0EsV0FBVyxNQUFYLEdBQW9CLEtBQXBCO0FBQ0EsV0FBVyxNQUFYLEdBQW9CLFFBQXBCO0FBQ0EsV0FBVyxVQUFYLEdBQXdCLFlBQXhCO0FBQ0EsV0FBVyxTQUFYLEdBQXVCLEVBQXZCO0FBQ0EsV0FBVyxLQUFYLEdBQW1CLEtBQW5CO0FBQ0EsV0FBVyxJQUFYLEdBQWtCLEtBQWxCO0FBQ0EsV0FBVyxZQUFYLEdBQTBCLEtBQTFCO0FBQ0EsV0FBVyxpQkFBWCxHQUErQixJQUEvQjs7QUFFQSxXQUFXLElBQVg7Ozs7Ozs7QUN2QkE7Ozs7Ozs7O0lBQ00sSTtBQUNMLGlCQUFjO0FBQUE7O0FBQ2I7QUFDQSxNQUFJLE9BQU8sUUFBUCxDQUFKLEVBQXNCLE9BQU8sSUFBUCxDQUFZLHFCQUFXLEtBQXZCLEVBQThCLHFCQUFXLE1BQXpDLEVBQXRCLEtBQ0ssS0FBSyxJQUFMLENBQVUscUJBQVcsS0FBckIsRUFBNEIscUJBQVcsTUFB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QUFDYiw4QkFBVSxJQUFWO0FBQ0EsMkJBQU8sT0FBUDtBQUNILGlCQUhELE1BSUs7QUFDRCx3QkFBSSxLQUFLLEtBQVQsRUFBZ0IsS0FBaEIsS0FDSztBQUNSO0FBQ0o7QUFDRCxnQkFBSSxLQUFLLENBQUwsSUFBVSxPQUFPLENBQXJCLEVBQXdCO0FBQ3BCLDBCQUFVLElBQVY7QUFDSDtBQUNELG1CQUFPLE9BQVA7QUFDSDs7OztFQWhFcUMsS0FBSyxLOztrQkFBMUIsWSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvKipUaGlzIGNsYXNzIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGJ5IExheWFBaXJJREUsIHBsZWFzZSBkbyBub3QgbWFrZSBhbnkgbW9kaWZpY2F0aW9ucy4gKi9cclxuaW1wb3J0IENoZWNrUmF5Y2FzdCBmcm9tIFwiLi9zY3JpcHQvQ2hlY2tSYXljYXN0XCJcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVDb25maWcge1xyXG4gICAgc3RhdGljIGluaXQoKSB7XHJcbiAgICAgICAgLy/ms6jlhoxTY3JpcHTmiJbogIVSdW50aW1l5byV55SoXHJcbiAgICAgICAgbGV0IHJlZyA9IExheWEuQ2xhc3NVdGlscy5yZWdDbGFzcztcclxuXHRcdHJlZyhcInNjcmlwdC9DaGVja1JheWNhc3QuanNcIixDaGVja1JheWNhc3QpO1xyXG4gICAgfVxyXG59XHJcbkdhbWVDb25maWcud2lkdGggPSAxMjgwO1xyXG5HYW1lQ29uZmlnLmhlaWdodCA9IDcyMDtcclxuR2FtZUNvbmZpZy5zY2FsZU1vZGUgPVwic2hvd2FsbFwiO1xyXG5HYW1lQ29uZmlnLnNjcmVlbk1vZGUgPSBcIm5vbmVcIjtcclxuR2FtZUNvbmZpZy5hbGlnblYgPSBcInRvcFwiO1xyXG5HYW1lQ29uZmlnLmFsaWduSCA9IFwiY2VudGVyXCI7XHJcbkdhbWVDb25maWcuc3RhcnRTY2VuZSA9IFwibWFpbi5zY2VuZVwiO1xyXG5HYW1lQ29uZmlnLnNjZW5lUm9vdCA9IFwiXCI7XHJcbkdhbWVDb25maWcuZGVidWcgPSBmYWxzZTtcclxuR2FtZUNvbmZpZy5zdGF0ID0gZmFsc2U7XHJcbkdhbWVDb25maWcucGh5c2ljc0RlYnVnID0gZmFsc2U7XHJcbkdhbWVDb25maWcuZXhwb3J0U2NlbmVUb0pzb24gPSB0cnVlO1xyXG5cclxuR2FtZUNvbmZpZy5pbml0KCk7XHJcbiIsImltcG9ydCBHYW1lQ29uZmlnIGZyb20gXCIuL0dhbWVDb25maWdcIjtcclxuY2xhc3MgTWFpbiB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvL+agueaNrklEReiuvue9ruWIneWni+WMluW8leaTjlx0XHRcclxuXHRcdGlmICh3aW5kb3dbXCJMYXlhM0RcIl0pIExheWEzRC5pbml0KEdhbWVDb25maWcud2lkdGgsIEdhbWVDb25maWcuaGVpZ2h0KTtcclxuXHRcdGVsc2UgTGF5YS5pbml0KEdhbWVDb25maWcud2lkdGgsIEdhbWVDb25maWcuaGVpZ2h0LCBMYXlhW1wiV2ViR0xcIl0pO1xyXG5cdFx0TGF5YVtcIlBoeXNpY3NcIl0gJiYgTGF5YVtcIlBoeXNpY3NcIl0uZW5hYmxlKCk7XHJcblx0XHRMYXlhW1wiRGVidWdQYW5lbFwiXSAmJiBMYXlhW1wiRGVidWdQYW5lbFwiXS5lbmFibGUoKTtcclxuXHRcdExheWEuc3RhZ2Uuc2NhbGVNb2RlID0gR2FtZUNvbmZpZy5zY2FsZU1vZGU7XHJcblx0XHRMYXlhLnN0YWdlLnNjcmVlbk1vZGUgPSBHYW1lQ29uZmlnLnNjcmVlbk1vZGU7XHJcblx0XHRMYXlhLnN0YWdlLmFsaWduViA9IEdhbWVDb25maWcuYWxpZ25WO1xyXG5cdFx0TGF5YS5zdGFnZS5hbGlnbkggPSBHYW1lQ29uZmlnLmFsaWduSDtcclxuXHRcdC8v5YW85a655b6u5L+h5LiN5pSv5oyB5Yqg6L29c2NlbmXlkI7nvIDlnLrmma9cclxuXHRcdExheWEuVVJMLmV4cG9ydFNjZW5lVG9Kc29uID0gR2FtZUNvbmZpZy5leHBvcnRTY2VuZVRvSnNvbjtcclxuXHJcblx0XHQvL+aJk+W8gOiwg+ivlemdouadv++8iOmAmui/h0lEReiuvue9ruiwg+ivleaooeW8j++8jOaIluiAhXVybOWcsOWdgOWinuWKoGRlYnVnPXRydWXlj4LmlbDvvIzlnYflj6/miZPlvIDosIPor5XpnaLmnb/vvIlcclxuXHRcdGlmIChHYW1lQ29uZmlnLmRlYnVnIHx8IExheWEuVXRpbHMuZ2V0UXVlcnlTdHJpbmcoXCJkZWJ1Z1wiKSA9PSBcInRydWVcIikgTGF5YS5lbmFibGVEZWJ1Z1BhbmVsKCk7XHJcblx0XHRpZiAoR2FtZUNvbmZpZy5waHlzaWNzRGVidWcgJiYgTGF5YVtcIlBoeXNpY3NEZWJ1Z0RyYXdcIl0pIExheWFbXCJQaHlzaWNzRGVidWdEcmF3XCJdLmVuYWJsZSgpO1xyXG5cdFx0aWYgKEdhbWVDb25maWcuc3RhdCkgTGF5YS5TdGF0LnNob3coKTtcclxuXHRcdExheWEuYWxlcnRHbG9iYWxFcnJvciA9IHRydWU7XHJcblxyXG5cdFx0Ly/mv4DmtLvotYTmupDniYjmnKzmjqfliLbvvIx2ZXJzaW9uLmpzb27nlLFJREXlj5HluIPlip/og73oh6rliqjnlJ/miJDvvIzlpoLmnpzmsqHmnInkuZ/kuI3lvbHlk43lkI7nu63mtYHnqItcclxuXHRcdExheWEuUmVzb3VyY2VWZXJzaW9uLmVuYWJsZShcInZlcnNpb24uanNvblwiLCBMYXlhLkhhbmRsZXIuY3JlYXRlKHRoaXMsIHRoaXMub25WZXJzaW9uTG9hZGVkKSwgTGF5YS5SZXNvdXJjZVZlcnNpb24uRklMRU5BTUVfVkVSU0lPTik7XHJcblx0fVxyXG5cclxuXHRvblZlcnNpb25Mb2FkZWQoKSB7XHJcblx0XHQvL+a/gOa0u+Wkp+Wwj+WbvuaYoOWwhO+8jOWKoOi9veWwj+WbvueahOaXtuWAme+8jOWmguaenOWPkeeOsOWwj+WbvuWcqOWkp+WbvuWQiOmbhumHjOmdou+8jOWImeS8mOWFiOWKoOi9veWkp+WbvuWQiOmbhu+8jOiAjOS4jeaYr+Wwj+WbvlxyXG5cdFx0TGF5YS5BdGxhc0luZm9NYW5hZ2VyLmVuYWJsZShcImZpbGVjb25maWcuanNvblwiLCBMYXlhLkhhbmRsZXIuY3JlYXRlKHRoaXMsIHRoaXMub25Db25maWdMb2FkZWQpKTtcclxuXHR9XHJcblxyXG5cdG9uQ29uZmlnTG9hZGVkKCkge1xyXG5cdFx0Ly/liqDovb1JREXmjIflrprnmoTlnLrmma9cclxuXHRcdEdhbWVDb25maWcuc3RhcnRTY2VuZSAmJiBMYXlhLlNjZW5lLm9wZW4oR2FtZUNvbmZpZy5zdGFydFNjZW5lKTtcclxuXHR9XHJcbn1cclxuLy/mv4DmtLvlkK/liqjnsbtcclxubmV3IE1haW4oKTtcclxuIiwiLyoqQ2hlY2tSYXljYXN0ICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENoZWNrUmF5Y2FzdCBleHRlbmRzIExheWEuU2NlbmUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7IHN1cGVyKCk7IH1cclxuICAgIG9uRW5hYmxlKCkge1xyXG4gICAgICAgIHZhciBjb251dCA9IDA7XHJcbiAgICAgICAgdmFyIHZlcnRleHMgPSBbXTtcclxuICAgICAgICB2YXIgY2hlY2tlZFBvaW50ID0gbnVsbDtcclxuICAgICAgICBMYXlhLnN0YWdlLm9uKExheWEuRXZlbnQuQ0xJQ0ssIHRoaXMsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBsYXlhLm1hdGhzLlBvaW50KGUuc3RhZ2VYLCBlLnN0YWdlWSk7XHJcbiAgICAgICAgICAgIGlmICh2ZXJ0ZXhzLmxlbmd0aCA8IDUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2ZXJ0ZXhzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFBvaW50ID0gdmVydGV4c1t2ZXJ0ZXhzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgIExheWEuc3RhZ2UuZ3JhcGhpY3MuZHJhd0xpbmUobGFzdFBvaW50LngsIGxhc3RQb2ludC55LCBwb2ludC54LCBwb2ludC55LCBcIiNmZmZmZmZcIiwgMyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2ZXJ0ZXhzLnB1c2gocG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZlcnRleHMubGVuZ3RoID09PSA1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0UG9pbnQgPSB2ZXJ0ZXhzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIExheWEuc3RhZ2UuZ3JhcGhpY3MuZHJhd0xpbmUoc3RhcnRQb2ludC54LCBzdGFydFBvaW50LnksIHBvaW50LngsIHBvaW50LnksIFwiI2ZmZmZmZlwiLCAzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8v5a6a5LmJ5Y6f54K5KDAsMClcclxuICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSBuZXcgbGF5YS5tYXRocy5Qb2ludCgwLCAwKTtcclxuICAgICAgICAgICAgICAgIHZhciBjaGVja1Jlc3V0ID0gdGhpcy5jaGVja0Nyb3NzKG9yaWdpbiwgcG9pbnQsIHZlcnRleHMpO1xyXG4gICAgICAgICAgICAgICAgLy/lpoLmnpzlsITnur/nqb/ov4flpJrovrnlvaLvvIzmmK/nu7/oibJcclxuICAgICAgICAgICAgICAgIHZhciBjb2xvciA9IFwiIzAwZmYwMFwiO1xyXG4gICAgICAgICAgICAgICAgLy/lpoLmnpzlsITnur/mnKrnqb/ov4flpJrovrnlvaLvvIzmmK/pu4ToibJcclxuICAgICAgICAgICAgICAgIGlmIChjaGVja1Jlc3V0ID09PSBmYWxzZSkgY29sb3IgPSBcIiNmZmZmMDBcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MuY2xlYXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBlbmRYID0gMTUwMDtcclxuICAgICAgICAgICAgICAgIHZhciBlbmRZID0gcG9pbnQueSAqIGVuZFggLyBwb2ludC54O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5kcmF3TGluZShvcmlnaW4ueCwgb3JpZ2luLnksIGVuZFgsIGVuZFksIGNvbG9yLCAzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKuajgOa1i+ebtOe6v+epv+i/h+S4gOS4quWkmui+ueW9oiAqL1xyXG4gICAgY2hlY2tDcm9zcyhzdGFydFBvaW50LCBzdG9wUG9pbnQsIHZlcnRleHMpIHtcclxuICAgICAgICB2YXIgeF9zdGFydFBvaW50ID0gc3RhcnRQb2ludC54O1xyXG4gICAgICAgIHZhciB5X3N0YXJ0UG9pbnQgPSBzdGFydFBvaW50Lnk7XHJcbiAgICAgICAgdmFyIHhfc3RvcFBvaW50ID0gc3RvcFBvaW50Lng7XHJcbiAgICAgICAgdmFyIHlfc3RvcFBvaW50ID0gc3RvcFBvaW50Lnk7XHJcblxyXG4gICAgICAgIHZhciB1cCA9IDA7XHJcbiAgICAgICAgdmFyIGRvd24gPSAwO1xyXG4gICAgICAgIHZhciBjcm9zc2VkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciBrID0gKHlfc3RvcFBvaW50IC0geV9zdGFydFBvaW50KSAvICh4X3N0b3BQb2ludCAtIHhfc3RhcnRQb2ludCk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2ZXJ0ZXhzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciB4aSA9IHZlcnRleHNbaV0ueCwgeWkgPSB2ZXJ0ZXhzW2ldLnk7XHJcbiAgICAgICAgICAgIHZhciB5X2N1dCA9IGsgKiAoeGkgLSB4X3N0YXJ0UG9pbnQpICsgeV9zdGFydFBvaW50O1xyXG4gICAgICAgICAgICAvL+Wkmui+ueW9ouS4juebtOe6v+ebuOWIh+aIluepv+i/h1xyXG4gICAgICAgICAgICBpZiAoeV9jdXQgPT0geWkpIHtcclxuICAgICAgICAgICAgICAgIGNyb3NzZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNyb3NzZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeWkgPiB5X2N1dCkgdXArKztcclxuICAgICAgICAgICAgICAgIGVsc2UgZG93bisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh1cCA+IDAgJiYgZG93biA+IDApIHtcclxuICAgICAgICAgICAgY3Jvc3NlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjcm9zc2VkO1xyXG4gICAgfVxyXG59Il19
